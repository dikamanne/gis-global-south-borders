{"ast":null,"code":"import * as React from 'react';\nimport { useState, useRef, useEffect, useContext, useMemo, useImperativeHandle } from 'react';\nimport { MountedMapsContext } from \"./use-map.js\";\nimport Maplibre from \"../maplibre/maplibre.js\";\nimport createRef from \"../maplibre/create-ref.js\";\nimport useIsomorphicLayoutEffect from \"../utils/use-isomorphic-layout-effect.js\";\nimport setGlobals from \"../utils/set-globals.js\";\nexport const MapContext = React.createContext(null);\nfunction _Map(props, ref) {\n  const mountedMapsContext = useContext(MountedMapsContext);\n  const [mapInstance, setMapInstance] = useState(null);\n  const containerRef = useRef();\n  const {\n    current: contextValue\n  } = useRef({\n    mapLib: null,\n    map: null\n  });\n  useEffect(() => {\n    const mapLib = props.mapLib;\n    let isMounted = true;\n    let maplibre;\n    Promise.resolve(mapLib || import('maplibre-gl')).then(module => {\n      if (!isMounted) {\n        return;\n      }\n      if (!module) {\n        throw new Error('Invalid mapLib');\n      }\n      const mapboxgl = 'Map' in module ? module : module.default;\n      if (!mapboxgl.Map) {\n        throw new Error('Invalid mapLib');\n      }\n      // workerUrl & workerClass may change the result of supported()\n      // https://github.com/visgl/react-map-gl/discussions/2027\n      setGlobals(mapboxgl, props);\n      if (!mapboxgl.supported || mapboxgl.supported(props)) {\n        if (props.reuseMaps) {\n          maplibre = Maplibre.reuse(props, containerRef.current);\n        }\n        if (!maplibre) {\n          maplibre = new Maplibre(mapboxgl.Map, props, containerRef.current);\n        }\n        contextValue.map = createRef(maplibre);\n        contextValue.mapLib = mapboxgl;\n        setMapInstance(maplibre);\n        mountedMapsContext?.onMapMount(contextValue.map, props.id);\n      } else {\n        throw new Error('Map is not supported by this browser');\n      }\n    }).catch(error => {\n      const {\n        onError\n      } = props;\n      if (onError) {\n        onError({\n          type: 'error',\n          target: null,\n          originalEvent: null,\n          error\n        });\n      } else {\n        console.error(error); // eslint-disable-line\n      }\n    });\n    return () => {\n      isMounted = false;\n      if (maplibre) {\n        mountedMapsContext?.onMapUnmount(props.id);\n        if (props.reuseMaps) {\n          maplibre.recycle();\n        } else {\n          maplibre.destroy();\n        }\n      }\n    };\n  }, []);\n  useIsomorphicLayoutEffect(() => {\n    if (mapInstance) {\n      mapInstance.setProps(props);\n    }\n  });\n  useImperativeHandle(ref, () => contextValue.map, [mapInstance]);\n  const style = useMemo(() => ({\n    position: 'relative',\n    width: '100%',\n    height: '100%',\n    ...props.style\n  }), [props.style]);\n  const CHILD_CONTAINER_STYLE = {\n    height: '100%'\n  };\n  return React.createElement(\"div\", {\n    id: props.id,\n    ref: containerRef,\n    style: style\n  }, mapInstance && React.createElement(MapContext.Provider, {\n    value: contextValue\n  }, React.createElement(\"div\", {\n    \"mapboxgl-children\": \"\",\n    style: CHILD_CONTAINER_STYLE\n  }, props.children)));\n}\nexport const Map = React.forwardRef(_Map);","map":{"version":3,"names":["React","useState","useRef","useEffect","useContext","useMemo","useImperativeHandle","MountedMapsContext","Maplibre","createRef","useIsomorphicLayoutEffect","setGlobals","MapContext","createContext","_Map","props","ref","mountedMapsContext","mapInstance","setMapInstance","containerRef","current","contextValue","mapLib","map","isMounted","maplibre","Promise","resolve","then","module","Error","mapboxgl","default","Map","supported","reuseMaps","reuse","onMapMount","id","catch","error","onError","type","target","originalEvent","console","onMapUnmount","recycle","destroy","setProps","style","position","width","height","CHILD_CONTAINER_STYLE","createElement","Provider","value","children","forwardRef"],"sources":["/Users/dikamanne/node_modules/@vis.gl/react-maplibre/src/components/map.tsx"],"sourcesContent":["import * as React from 'react';\nimport {useState, useRef, useEffect, useContext, useMemo, useImperativeHandle} from 'react';\n\nimport {MountedMapsContext} from './use-map';\nimport Maplibre, {MaplibreProps} from '../maplibre/maplibre';\nimport createRef, {MapRef} from '../maplibre/create-ref';\n\nimport type {CSSProperties} from 'react';\nimport useIsomorphicLayoutEffect from '../utils/use-isomorphic-layout-effect';\nimport setGlobals, {GlobalSettings} from '../utils/set-globals';\nimport type {MapLib, MapOptions} from '../types/lib';\n\nexport type MapContextValue = {\n  mapLib: MapLib;\n  map: MapRef;\n};\n\nexport const MapContext = React.createContext<MapContextValue>(null);\n\ntype MapInitOptions = Omit<\n  MapOptions,\n  'style' | 'container' | 'bounds' | 'fitBoundsOptions' | 'center'\n>;\n\nexport type MapProps = MapInitOptions &\n  MaplibreProps &\n  GlobalSettings & {\n    mapLib?: MapLib | Promise<MapLib>;\n    reuseMaps?: boolean;\n    /** Map container id */\n    id?: string;\n    /** Map container CSS style */\n    style?: CSSProperties;\n    children?: any;\n  };\n\nfunction _Map(props: MapProps, ref: React.Ref<MapRef>) {\n  const mountedMapsContext = useContext(MountedMapsContext);\n  const [mapInstance, setMapInstance] = useState<Maplibre>(null);\n  const containerRef = useRef();\n\n  const {current: contextValue} = useRef<MapContextValue>({mapLib: null, map: null});\n\n  useEffect(() => {\n    const mapLib = props.mapLib;\n    let isMounted = true;\n    let maplibre: Maplibre;\n\n    Promise.resolve(mapLib || import('maplibre-gl'))\n      .then((module: MapLib | {default: MapLib}) => {\n        if (!isMounted) {\n          return;\n        }\n        if (!module) {\n          throw new Error('Invalid mapLib');\n        }\n        const mapboxgl = 'Map' in module ? module : module.default;\n        if (!mapboxgl.Map) {\n          throw new Error('Invalid mapLib');\n        }\n\n        // workerUrl & workerClass may change the result of supported()\n        // https://github.com/visgl/react-map-gl/discussions/2027\n        setGlobals(mapboxgl, props);\n        if (!mapboxgl.supported || mapboxgl.supported(props)) {\n          if (props.reuseMaps) {\n            maplibre = Maplibre.reuse(props, containerRef.current);\n          }\n          if (!maplibre) {\n            maplibre = new Maplibre(mapboxgl.Map, props, containerRef.current);\n          }\n          contextValue.map = createRef(maplibre);\n          contextValue.mapLib = mapboxgl;\n\n          setMapInstance(maplibre);\n          mountedMapsContext?.onMapMount(contextValue.map, props.id);\n        } else {\n          throw new Error('Map is not supported by this browser');\n        }\n      })\n      .catch(error => {\n        const {onError} = props;\n        if (onError) {\n          onError({\n            type: 'error',\n            target: null,\n            originalEvent: null,\n            error\n          });\n        } else {\n          console.error(error); // eslint-disable-line\n        }\n      });\n\n    return () => {\n      isMounted = false;\n      if (maplibre) {\n        mountedMapsContext?.onMapUnmount(props.id);\n        if (props.reuseMaps) {\n          maplibre.recycle();\n        } else {\n          maplibre.destroy();\n        }\n      }\n    };\n  }, []);\n\n  useIsomorphicLayoutEffect(() => {\n    if (mapInstance) {\n      mapInstance.setProps(props);\n    }\n  });\n\n  useImperativeHandle(ref, () => contextValue.map, [mapInstance]);\n\n  const style: CSSProperties = useMemo(\n    () => ({\n      position: 'relative',\n      width: '100%',\n      height: '100%',\n      ...props.style\n    }),\n    [props.style]\n  );\n\n  const CHILD_CONTAINER_STYLE = {\n    height: '100%'\n  };\n\n  return (\n    <div id={props.id} ref={containerRef} style={style}>\n      {mapInstance && (\n        <MapContext.Provider value={contextValue}>\n          <div mapboxgl-children=\"\" style={CHILD_CONTAINER_STYLE}>\n            {props.children}\n          </div>\n        </MapContext.Provider>\n      )}\n    </div>\n  );\n}\n\nexport const Map = React.forwardRef(_Map);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}