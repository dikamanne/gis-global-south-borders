{"ast":null,"code":"import { useImperativeHandle, useRef, useEffect, forwardRef, memo } from 'react';\nimport { applyReactStyle } from \"../utils/apply-react-style.js\";\nimport { useControl } from \"./use-control.js\";\nfunction _GeolocateControl(props, ref) {\n  const thisRef = useRef({\n    props\n  });\n  const ctrl = useControl(({\n    mapLib\n  }) => {\n    const gc = new mapLib.GeolocateControl(props);\n    // Hack: fix GeolocateControl reuse\n    // When using React strict mode, the component is mounted twice.\n    // GeolocateControl's UI creation is asynchronous. Removing and adding it back causes the UI to be initialized twice.\n    const setupUI = gc._setupUI;\n    gc._setupUI = () => {\n      if (!gc._container.hasChildNodes()) {\n        setupUI();\n      }\n    };\n    gc.on('geolocate', e => {\n      thisRef.current.props.onGeolocate?.(e);\n    });\n    gc.on('error', e => {\n      thisRef.current.props.onError?.(e);\n    });\n    gc.on('outofmaxbounds', e => {\n      thisRef.current.props.onOutOfMaxBounds?.(e);\n    });\n    gc.on('trackuserlocationstart', e => {\n      thisRef.current.props.onTrackUserLocationStart?.(e);\n    });\n    gc.on('trackuserlocationend', e => {\n      thisRef.current.props.onTrackUserLocationEnd?.(e);\n    });\n    return gc;\n  }, {\n    position: props.position\n  });\n  thisRef.current.props = props;\n  useImperativeHandle(ref, () => ctrl, []);\n  useEffect(() => {\n    applyReactStyle(ctrl._container, props.style);\n  }, [props.style]);\n  return null;\n}\nexport const GeolocateControl = memo(forwardRef(_GeolocateControl));","map":{"version":3,"names":["useImperativeHandle","useRef","useEffect","forwardRef","memo","applyReactStyle","useControl","_GeolocateControl","props","ref","thisRef","ctrl","mapLib","gc","GeolocateControl","setupUI","_setupUI","_container","hasChildNodes","on","e","current","onGeolocate","onError","onOutOfMaxBounds","onTrackUserLocationStart","onTrackUserLocationEnd","position","style"],"sources":["/Users/dikamanne/node_modules/@vis.gl/react-maplibre/src/components/geolocate-control.ts"],"sourcesContent":["import * as React from 'react';\nimport {useImperativeHandle, useRef, useEffect, forwardRef, memo} from 'react';\nimport {applyReactStyle} from '../utils/apply-react-style';\nimport {useControl} from './use-control';\n\nimport type {\n  ControlPosition,\n  GeolocateControlInstance,\n  GeolocateControlOptions\n} from '../types/lib';\nimport type {GeolocateEvent, GeolocateResultEvent, GeolocateErrorEvent} from '../types/events';\n\nexport type GeolocateControlProps = GeolocateControlOptions & {\n  /** Placement of the control relative to the map. */\n  position?: ControlPosition;\n  /** CSS style override, applied to the control's container */\n  style?: React.CSSProperties;\n\n  /** Called on each Geolocation API position update that returned as success. */\n  onGeolocate?: (e: GeolocateResultEvent) => void;\n  /** Called on each Geolocation API position update that returned as an error. */\n  onError?: (e: GeolocateErrorEvent) => void;\n  /** Called on each Geolocation API position update that returned as success but user position\n   * is out of map `maxBounds`. */\n  onOutOfMaxBounds?: (e: GeolocateResultEvent) => void;\n  /** Called when the GeolocateControl changes to the active lock state. */\n  onTrackUserLocationStart?: (e: GeolocateEvent) => void;\n  /** Called when the GeolocateControl changes to the background state. */\n  onTrackUserLocationEnd?: (e: GeolocateEvent) => void;\n};\n\nfunction _GeolocateControl(props: GeolocateControlProps, ref: React.Ref<GeolocateControlInstance>) {\n  const thisRef = useRef({props});\n\n  const ctrl = useControl(\n    ({mapLib}) => {\n      const gc = new mapLib.GeolocateControl(props);\n\n      // Hack: fix GeolocateControl reuse\n      // When using React strict mode, the component is mounted twice.\n      // GeolocateControl's UI creation is asynchronous. Removing and adding it back causes the UI to be initialized twice.\n      const setupUI = gc._setupUI;\n      gc._setupUI = () => {\n        if (!gc._container.hasChildNodes()) {\n          setupUI();\n        }\n      };\n\n      gc.on('geolocate', e => {\n        thisRef.current.props.onGeolocate?.(e as GeolocateResultEvent);\n      });\n      gc.on('error', e => {\n        thisRef.current.props.onError?.(e as GeolocateErrorEvent);\n      });\n      gc.on('outofmaxbounds', e => {\n        thisRef.current.props.onOutOfMaxBounds?.(e as GeolocateResultEvent);\n      });\n      gc.on('trackuserlocationstart', e => {\n        thisRef.current.props.onTrackUserLocationStart?.(e as GeolocateEvent);\n      });\n      gc.on('trackuserlocationend', e => {\n        thisRef.current.props.onTrackUserLocationEnd?.(e as GeolocateEvent);\n      });\n\n      return gc;\n    },\n    {position: props.position}\n  );\n\n  thisRef.current.props = props;\n\n  useImperativeHandle(ref, () => ctrl, []);\n\n  useEffect(() => {\n    applyReactStyle(ctrl._container, props.style);\n  }, [props.style]);\n\n  return null;\n}\n\nexport const GeolocateControl = memo(forwardRef(_GeolocateControl));\n"],"mappings":"AACA,SAAQA,mBAAmB,EAAEC,MAAM,EAAEC,SAAS,EAAEC,UAAU,EAAEC,IAAI,QAAO,OAAO;AAC9E,SAAQC,eAAe,QAAC;AACxB,SAAQC,UAAU,QAAC;AA4BnB,SAASC,iBAAiBA,CAACC,KAA4B,EAAEC,GAAwC;EAC/F,MAAMC,OAAO,GAAGT,MAAM,CAAC;IAACO;EAAK,CAAC,CAAC;EAE/B,MAAMG,IAAI,GAAGL,UAAU,CACrB,CAAC;IAACM;EAAM,CAAC,KAAI;IACX,MAAMC,EAAE,GAAG,IAAID,MAAM,CAACE,gBAAgB,CAACN,KAAK,CAAC;IAE7C;IACA;IACA;IACA,MAAMO,OAAO,GAAGF,EAAE,CAACG,QAAQ;IAC3BH,EAAE,CAACG,QAAQ,GAAG,MAAK;MACjB,IAAI,CAACH,EAAE,CAACI,UAAU,CAACC,aAAa,EAAE,EAAE;QAClCH,OAAO,EAAE;MACX;IACF,CAAC;IAEDF,EAAE,CAACM,EAAE,CAAC,WAAW,EAAEC,CAAC,IAAG;MACrBV,OAAO,CAACW,OAAO,CAACb,KAAK,CAACc,WAAW,GAAGF,CAAyB,CAAC;IAChE,CAAC,CAAC;IACFP,EAAE,CAACM,EAAE,CAAC,OAAO,EAAEC,CAAC,IAAG;MACjBV,OAAO,CAACW,OAAO,CAACb,KAAK,CAACe,OAAO,GAAGH,CAAwB,CAAC;IAC3D,CAAC,CAAC;IACFP,EAAE,CAACM,EAAE,CAAC,gBAAgB,EAAEC,CAAC,IAAG;MAC1BV,OAAO,CAACW,OAAO,CAACb,KAAK,CAACgB,gBAAgB,GAAGJ,CAAyB,CAAC;IACrE,CAAC,CAAC;IACFP,EAAE,CAACM,EAAE,CAAC,wBAAwB,EAAEC,CAAC,IAAG;MAClCV,OAAO,CAACW,OAAO,CAACb,KAAK,CAACiB,wBAAwB,GAAGL,CAAmB,CAAC;IACvE,CAAC,CAAC;IACFP,EAAE,CAACM,EAAE,CAAC,sBAAsB,EAAEC,CAAC,IAAG;MAChCV,OAAO,CAACW,OAAO,CAACb,KAAK,CAACkB,sBAAsB,GAAGN,CAAmB,CAAC;IACrE,CAAC,CAAC;IAEF,OAAOP,EAAE;EACX,CAAC,EACD;IAACc,QAAQ,EAAEnB,KAAK,CAACmB;EAAQ,CAAC,CAC3B;EAEDjB,OAAO,CAACW,OAAO,CAACb,KAAK,GAAGA,KAAK;EAE7BR,mBAAmB,CAACS,GAAG,EAAE,MAAME,IAAI,EAAE,EAAE,CAAC;EAExCT,SAAS,CAAC,MAAK;IACbG,eAAe,CAACM,IAAI,CAACM,UAAU,EAAET,KAAK,CAACoB,KAAK,CAAC;EAC/C,CAAC,EAAE,CAACpB,KAAK,CAACoB,KAAK,CAAC,CAAC;EAEjB,OAAO,IAAI;AACb;AAEA,OAAO,MAAMd,gBAAgB,GAAGV,IAAI,CAACD,UAAU,CAACI,iBAAiB,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}